<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>User CRUD</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 2rem auto;
    }

    input,
    button {
      padding: 0.5rem;
      margin: 0.25rem 0;
      width: 100%;
    }

    button.small-btn {
      width: auto;
      margin-left: 0.5rem;
    }

    .user {
      padding: 0.5rem;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .actions {
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <button onclick="goHome()">‚Üê Go to Home</button>

  <h2 id="form-title">Add User</h2>
  <input id="name" placeholder="Name" />
  <input id="email" placeholder="Email" />
  <button onclick="submitUser()">Save</button>
  <input type="hidden" id="userId" />

  <h2>All Users</h2>
  <button onclick="loadUsers()">Reload List</button>
  <div id="users"></div>

  <script>
    const apiBase = `https://node-boilerplate-o1ll.onrender.com/api`;
    // const apiBase = `http://localhost:5000/api`;

    function goHome() {
      window.location.href = '/';
    }

    async function submitUser() {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const userId = document.getElementById('userId').value;

      if (!name || !email) {
        alert('Please enter both name and email');
        return;
      }

      const payload = { name, email };
      let res;

      if (userId) {
        // Update user
        res = await fetch(`${apiBase}/user/${userId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
      } else {
        // Create user
        res = await fetch(`${apiBase}/user`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
      }

      if (res.ok) {
        alert(userId ? 'User updated!' : 'User added!');
        resetForm();
        loadUsers();
      } else {
        alert('Operation failed');
      }
    }

    function editUser(user) {
      document.getElementById('name').value = user.name;
      document.getElementById('email').value = user.email;
      document.getElementById('userId').value = user._id;
      document.getElementById('form-title').textContent = 'Edit User';
    }

    function resetForm() {
      document.getElementById('name').value = '';
      document.getElementById('email').value = '';
      document.getElementById('userId').value = '';
      document.getElementById('form-title').textContent = 'Add User';
    }

    async function deleteUser(id) {
      if (!confirm('Are you sure you want to delete this user?')) return;

      const res = await fetch(`${apiBase}/user/${id}`, {
        method: 'DELETE'
      });

      if (res.ok) {
        alert('User deleted');
        loadUsers();
      } else {
        alert('Failed to delete user');
      }
    }

    async function loadUsers() {
      const res = await fetch(`${apiBase}/users`);
      const users = await res.json();
      const usersDiv = document.getElementById('users');
      usersDiv.innerHTML = '';
      users.forEach(u => {
        const div = document.createElement('div');
        div.className = 'user';
        div.innerHTML = `
          <span>${u.name} (${u.email})</span>
          <span class="actions">
            <button class="small-btn" onclick='editUser(${JSON.stringify(u)})'>Edit</button>
            <button class="small-btn" onclick='deleteUser("${u._id}")'>Delete</button>
          </span>
        `;
        usersDiv.appendChild(div);
      });
    }

    // Initial load
    loadUsers();
  </script>
</body>

</html>